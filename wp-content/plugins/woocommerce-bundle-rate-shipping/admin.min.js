var ENDA_BUNDLERATE={};(function(e){ENDA_BUNDLERATE.updateLayerNames=function(t){var n=0,r=t.find("tr.rate_row");r.each(function(){e(this).find("input").each(function(){var t=e(this).attr("name").replace(/rates\]\[\d+\]/,"rates]["+n+"]");e(this).attr("name",t)});n+=1});return};ENDA_BUNDLERATE.updateStartCount=function(e){var t,n=e.parents("tr.rate_row").first(),r=n.next();if(e.hasClass("remove_bundle_layer")){t=parseInt(n.prev().find("input").first().val())+1}else{t=parseInt(e.val())+1}r.find("span.start_count").first().text(t)};ENDA_BUNDLERATE.toggleSpecificCountries=function(e){if(e.val()==="specific"){e.parent().next("div").show()}else{e.parent().next("div").hide()}};ENDA_BUNDLERATE.addLayer=function(t){if(t.attr("disabled")==="disabled"){return false}var n=this,r=t.parents("table").first(),i=r.find("tbody tr.rate_row").last(),s={action:"get_new_layer",start_count:parseInt(i.prev().find("input").first().val())+1,cost_input:i.find("input").last().attr("name"),products_input:i.find("input").first().attr("name")};e.post(ajaxurl,s,function(t){e(t).insertBefore(i);n.updateLayerNames(r)});return false};ENDA_BUNDLERATE.removeLayer=function(e){var t=e.parents("table").first();this.updateStartCount(e);e.parents("tr").first().remove();this.updateLayerNames(t);return false};ENDA_BUNDLERATE.disableAddLayerButton=function(e){var t=e.find("tr.rate_row input").first().val();if(!t||"0"===t||""===t){e.find(".add_layer").first().attr("disabled",true)}};ENDA_BUNDLERATE.addConfiguration=function(t){var n=e("#bundle_rate_configuration > tbody > tr"),r={action:"get_new_configuration_layer",index:n.length};e.post(ajaxurl,r,function(t){e(t).insertAfter(n.last());ENDA_BUNDLERATE.init()});return false};ENDA_BUNDLERATE.init=function(){var t=this;e(".shipping_destination .destination").on("change",function(){t.toggleSpecificCountries(e(this))}).change();e("select.chosen_select").chosen();e(".shipping_rates table").each(function(){t.disableAddLayerButton(e(this))})};e(document).ready(function(){var t=ENDA_BUNDLERATE;t.init();e("#bundle_rate_configuration").on("click",".add_layer",function(){return t.addLayer(e(this))}).on("click",".remove_bundle_layer",function(){return t.removeLayer(e(this))}).on("change","input.bundle_rate_products",function(){t.updateStartCount(e(this));if(!e(this).val()||"0"===e(this).val()||""===e(this).val()){e(this).parents("table").first().find(".add_layer").first().attr("disabled",true)}else{e(this).parents("table").first().find(".add_layer").first().attr("disabled",false)}}).on("click",".add_configuration",function(){return t.addConfiguration(e(this))})})})(jQuery)